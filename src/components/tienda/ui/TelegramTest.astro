---
// Componente de prueba para verificar la integraciÃ³n con Telegram
---

<div class="bg-cajas rounded-lg p-4 mb-4">
	<h3 class="text-lg font-semibold text-primary mb-3">
		ğŸ§ª Prueba de IntegraciÃ³n Telegram
	</h3>

	<div class="space-y-3">
		<button
			id="test-connection"
			class="w-full bg-[var(--accent-color)] hover:bg-[var(--accent-color-dark)] text-[var(--text-color)] px-4 py-2 rounded-lg transition-colors"
		>
			ğŸ”— Probar ConexiÃ³n
		</button>

		<button
			id="test-message"
			class="w-full bg-[var(--success-color)] hover:bg-[var(--success-color-dark)] text-[var(--text-color)] px-4 py-2 rounded-lg transition-colors"
		>
			ğŸ“¨ Enviar Mensaje de Prueba
		</button>

		<button
			id="test-favorite"
			class="w-full bg-[var(--primary-color)] hover:bg-[var(--primary-color-dark)] text-[var(--text-color)] px-4 py-2 rounded-lg transition-colors"
		>
			â¤ï¸ Simular Favorito
		</button>
	</div>

	<div
		id="test-results"
		class="mt-4 p-3 bg-[var(--cajas)] rounded-lg hidden"
	>
		<h4 class="font-semibold mb-2">Resultados:</h4>
		<pre
			id="test-output"
			class="text-sm text-[var(--text-color)] whitespace-pre-wrap">
		</pre>
	</div>
</div>

<script>
	import {
		testTelegramConnection,
		sendTestMessage,
		sendTelegramNotification,
	} from "../../../utils/telegram.js";

	function showResults(message: string, isError = false) {
		const resultsDiv = document.getElementById("test-results");
		const outputDiv = document.getElementById("test-output");

		if (resultsDiv && outputDiv) {
			resultsDiv.classList.remove("hidden");
			outputDiv.textContent = message;
			outputDiv.className = `text-sm whitespace-pre-wrap ${isError ? "text-red-600" : "text-green-600"}`;
		}
	}

	// Test connection
	document
		.getElementById("test-connection")
		?.addEventListener("click", async () => {
			try {
				showResults("ğŸ”„ Probando conexiÃ³n...", false);
				const result = await testTelegramConnection();

				if (result.success) {
					showResults(
						`âœ… ConexiÃ³n exitosa!\n\nBot: ${result.bot.first_name}\nUsername: @${result.bot.username}\nID: ${result.bot.id}`,
						false
					);
				} else {
					showResults(`âŒ Error de conexiÃ³n:\n${result.error}`, true);
				}
			} catch (error) {
				const errorMessage =
					error instanceof Error ? error.message : "Error desconocido";
				showResults(`âŒ Error inesperado:\n${errorMessage}`, true);
			}
		});

	// Test message
	document
		.getElementById("test-message")
		?.addEventListener("click", async () => {
			try {
				showResults("ğŸ”„ Enviando mensaje de prueba...", false);
				const result = await sendTestMessage();

				if (result.success) {
					showResults(
						"âœ… Mensaje de prueba enviado exitosamente!\n\nRevisa tu chat de Telegram.",
						false
					);
				} else {
					showResults(`âŒ Error al enviar mensaje:\n${result.error}`, true);
				}
			} catch (error) {
				const errorMessage =
					error instanceof Error ? error.message : "Error desconocido";
				showResults(`âŒ Error inesperado:\n${errorMessage}`, true);
			}
		});

	// Test favorite simulation
	document
		.getElementById("test-favorite")
		?.addEventListener("click", async () => {
			try {
				showResults("ğŸ”„ Simulando favorito...", false);
				const result = await sendTelegramNotification(
					"Producto de Prueba",
					"added"
				);

				if (result.success) {
					showResults(
						"âœ… NotificaciÃ³n de favorito enviada exitosamente!\n\nRevisa tu chat de Telegram.",
						false
					);
				} else {
					showResults(
						`âŒ Error al enviar notificaciÃ³n:\n${result.error}`,
						true
					);
				}
			} catch (error) {
				const errorMessage =
					error instanceof Error ? error.message : "Error desconocido";
				showResults(`âŒ Error inesperado:\n${errorMessage}`, true);
			}
		});
</script>
