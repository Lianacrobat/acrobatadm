<div class="relative group">
  <button
    id="theme-toggle"
    class="p-2 rounded-full hover:text-[var(--text)]/50 transition-colors"
  >
    <!-- System Icon -->
    <svg
      id="system-icon"
      xmlns="http://www.w3.org/2000/svg"
      width="24"
      height="24"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      stroke-width="2"
      stroke-linecap="round"
      stroke-linejoin="round"
      class="icon icon-tabler icons-tabler-outline icon-tabler-device-desktop"
    >
      <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
      <path
        d="M10.325 4.317c.426 -1.756 2.924 -1.756 3.35 0a1.724 1.724 0 0 0 2.573 1.066c1.543 -.94 3.31 .826 2.37 2.37a1.724 1.724 0 0 0 1.065 2.572c1.756 .426 1.756 2.924 0 3.35a1.724 1.724 0 0 0 -1.066 2.573c.94 1.543 -.826 3.31 -2.37 2.37a1.724 1.724 0 0 0 -2.572 1.065c-.426 1.756 -2.924 1.756 -3.35 0a1.724 1.724 0 0 0 -2.573 -1.066c-1.543 .94 -3.31 -.826 -2.37 -2.37a1.724 1.724 0 0 0 -1.065 -2.572c-1.756 -.426 -1.756 -2.924 0 -3.35a1.724 1.724 0 0 0 1.066 -2.573c-.94 -1.543 .826 -3.31 2.37 -2.37c1 .608 2.296 .07 2.572 -1.065z"
      ></path>
      <path d="M9 12a3 3 0 1 0 6 0a3 3 0 0 0 -6 0"></path>
    </svg>

    <!-- Dark Icon -->
    <svg
      id="dark-icon"
      xmlns="http://www.w3.org/2000/svg"
      width="24"
      height="24"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      stroke-width="2"
      stroke-linecap="round"
      stroke-linejoin="round"
      class="icon icon-tabler icons-tabler-outline icon-tabler-moon hidden"
    >
      <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
      <path
        d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"
      ></path>
    </svg>

    <!-- Light Icon -->
    <svg
      id="light-icon"
      xmlns="http://www.w3.org/2000/svg"
      width="24"
      height="24"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      stroke-width="2"
      stroke-linecap="round"
      stroke-linejoin="round"
      class="icon icon-tabler icons-tabler-outline icon-tabler-brightness-up hidden"
    >
      <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
      <path d="M12 12m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0"></path>
      <path d="M12 5l0 -2"></path>
      <path d="M17 7l1.4 -1.4"></path>
      <path d="M19 12l2 0"></path>
      <path d="M17 17l1.4 1.4"></path>
      <path d="M12 19l0 2"></path>
      <path d="M7 17l-1.4 1.4"></path>
      <path d="M6 12l-2 0"></path>
      <path d="M7 7l-1.4 -1.4"></path>
    </svg>
  </button>

  <!-- Tooltip -->
  <div
    class="absolute -top-8 left-1/2 -translate-x-1/2 px-2 py-1 bg-black text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap"
  >
    Apariencia
    <div
      class="absolute -bottom-1 left-1/2 -translate-x-1/2 w-2 h-2 bg-black rotate-45"
    >
    </div>
  </div>
</div>

<script>
  const themeToggle = document.getElementById("theme-toggle");
  const systemIcon = document.getElementById("system-icon");
  const darkIcon = document.getElementById("dark-icon");
  const lightIcon = document.getElementById("light-icon");

  // Get initial theme from localStorage or default to system
  let currentTheme = localStorage.getItem("theme") || "system";

  function updateIcon(theme: string) {
    // Hide all icons
    systemIcon?.classList.add("hidden");
    darkIcon?.classList.add("hidden");
    lightIcon?.classList.add("hidden");

    // Show selected icon with animation
    const iconToShow =
      theme === "system" ? systemIcon : theme === "dark" ? darkIcon : lightIcon;

    iconToShow?.classList.remove("hidden");
    iconToShow?.classList.add("rotate-pulse");

    // Remove animation class after animation completes
    setTimeout(() => {
      iconToShow?.classList.remove("rotate-pulse");
    }, 500);
  }

  function cycleTheme() {
    const themes = ["system", "dark", "light"];
    const currentIndex = themes.indexOf(currentTheme);
    const nextIndex = (currentIndex + 1) % themes.length;
    currentTheme = themes[nextIndex];

    // Save theme preference to localStorage
    localStorage.setItem("theme", currentTheme);

    if (currentTheme === "system") {
      const systemTheme = window.matchMedia("(prefers-color-scheme: dark)")
        .matches
        ? "dark"
        : "light";
      document.documentElement.setAttribute("data-theme", systemTheme);
    } else {
      document.documentElement.setAttribute("data-theme", currentTheme);
    }

    updateIcon(currentTheme);
  }

  // Set initial icon based on saved theme
  updateIcon(currentTheme);

  // Handle theme toggle clicks
  themeToggle?.addEventListener("click", cycleTheme);
</script>

<style>
  /* Rotate and pulse animation */
  .rotate-pulse {
    animation: rotate-pulse 0.5s ease-in-out;
  }

  @keyframes rotate-pulse {
    0% {
      transform: rotate(0deg) scale(1);
    }
    100% {
      transform: rotate(360deg) scale(1);
    }
  }
</style>
